---
- name: Reload systemd daemon
  ansible.builtin.systemd:
    daemon_reload: yes
  listen:
    - Reload systemd

- name: Restart MediaMTX service
  ansible.builtin.systemd:
    name: mediamtx
    state: restarted
    enabled: true
  listen:
    - Restart mediamtx
  when: not (mediamtx_reboot_required | default(false))

- name: Reboot after SPI change
  ansible.builtin.reboot:
    msg: "Rebooting to apply SPI configuration change (SPI enabled)."
    reboot_timeout: 600